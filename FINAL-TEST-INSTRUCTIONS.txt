========================================
FINAL TEST - APPOINTMENT BOOKING
========================================

FIXES APPLIED:
âœ… Frontend: Extract only from user messages
âœ… Frontend: Pakistani phone support (03xxxxxxxxx)
âœ… Frontend: Name extraction with colon support
âœ… Frontend: Time format handling (3pm)
âœ… Backend: Intent detection for confirmations
âœ… Backend: Debug logging added
âœ… Backend: Rate limit handling

========================================
TEST STEPS - FOLLOW EXACTLY
========================================

1. SERVER RESTART:
   Ctrl+C (stop server)
   npm run dev (start server)
   Wait for "Ready on http://localhost:3000"

2. OPEN CHAT:
   Go to: http://localhost:3000
   Click chat icon (bottom right)

3. SEND MESSAGES ONE BY ONE:
   
   Message 1: "kashif ali"
   (Wait for bot response)
   
   Message 2: "03272553940"
   (Wait for bot response)
   
   Message 3: "12/17/2025"
   (Wait for bot response)
   
   Message 4: "3pm"
   (Wait for bot response)
   
   Message 5: "consultation"
   (Wait for bot response - should ask for confirmation)
   
   Message 6: "yes please"
   (This should CREATE appointment)

4. CHECK TERMINAL LOGS:
   Look for:
   
   âœ… Extracted name: kashif ali
   âœ… Extracted appointment data: {
     patientName: 'kashif ali',
     phoneNumber: '03272553940',
     appointmentDate: '2025-12-17',
     appointmentTime: '3pm',
     appointmentType: 'consultation'
   }
   
   ðŸ” DEBUG BOOKING: {
     intent: 'book',  â† MUST be 'book'
     hasAllBookingData: true,  â† MUST be true
     isConfirmingBooking: true  â† MUST be true
   }
   
   âœ… Clinic found: [id]
   âœ… Patient ID: [id]
   ðŸ“… Creating appointment: {...}
   âœ… Appointment created successfully: [id]

5. VERIFY APPOINTMENT:
   
   A) Admin Dashboard:
      http://localhost:3000/admin
      Click "Appointments"
      Should see appointment for kashif ali
   
   B) Database:
      Supabase SQL Editor
      Run: CHECK-APPOINTMENTS-IN-DB.sql
      Should see appointment record

========================================
IF STILL NOT WORKING
========================================

COPY THESE LOGS:
1. Terminal output when you send "yes please"
2. Browser console (F12 > Console tab)
3. Screenshot of admin dashboard

SHARE WITH ME:
- Full terminal logs
- What you see in browser console
- Any error messages

========================================
EXPECTED RESULT
========================================

âœ… Bot says: "Your appointment is confirmed"
âœ… Confirmation code shown (CHAT-XXXXX)
âœ… Appointment appears in admin dashboard
âœ… Appointment appears in database
âœ… Patient record created with name and phone

========================================
COMMON ISSUES
========================================

Issue: patientName still false
Solution: Check browser console for "âœ… Extracted name:"
If missing, name regex not matching

Issue: intent still 'none'
Solution: hasAllBookingData is undefined/false
Missing required field (name, phone, date, or time)

Issue: hasAllBookingData undefined
Solution: appointmentData not being passed correctly
Check frontend is sending data to API

Issue: Appointment created but not showing
Solution: Check RLS policies in Supabase
Run: SELECT * FROM appointments; in SQL Editor
