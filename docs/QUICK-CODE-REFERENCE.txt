â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           PROJECT CODE FLOW - QUICK REFERENCE                  â•‘
â•‘              SanMiguel Connect AI System                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ PROJECT STRUCTURE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

app/
â”œâ”€â”€ page.tsx                    # Homepage (/)
â”œâ”€â”€ layout.tsx                  # Root layout
â”œâ”€â”€ admin/                      # Admin dashboard
â”‚   â”œâ”€â”€ page.tsx               # Dashboard home
â”‚   â”œâ”€â”€ patients/              # Patient management
â”‚   â”œâ”€â”€ appointments/          # Appointments
â”‚   â””â”€â”€ interactions/          # Logs
â””â”€â”€ api/                        # Backend APIs
    â”œâ”€â”€ appointments/          # Appointment APIs
    â”œâ”€â”€ clinics/               # Clinic info
    â”œâ”€â”€ faqs/                  # FAQ search
    â””â”€â”€ webhooks/              # External webhooks
        â”œâ”€â”€ vapi/              # Voice webhooks
        â””â”€â”€ telnyx/            # SMS/Voice webhooks

components/
â””â”€â”€ VapiVoiceCall.tsx          # Voice call button

lib/
â”œâ”€â”€ supabase.ts                # Database client
â”œâ”€â”€ openai.ts                  # AI integration
â”œâ”€â”€ telnyx.ts                  # SMS/Voice
â””â”€â”€ utils.ts                   # Helpers


ğŸš€ APPLICATION START FLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

User opens browser â†’ http://localhost:3000
    â†“
app/layout.tsx loads (Root wrapper)
    â†“
app/page.tsx renders (Homepage)
    â†“
Shows:
- Hero section "SanMiguel Connect AI"
- "Start Chat" button
- "Call Us" button (VapiVoiceCall)
- Features cards
- Clinic locations
- Footer


ğŸ“ VOICE CALL FLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. User clicks "Call Us"
2. VapiVoiceCall.tsx â†’ vapi.start(assistantId)
3. Browser asks microphone permission
4. Call connects to Vapi server
5. AI speaks: "Hello! How can I help?"
6. User speaks: "What are your hours?"
7. Vapi processes & responds
8. Vapi sends webhook â†’ POST /api/webhooks/vapi
9. Server logs:
   - INSERT INTO call_logs
   - INSERT INTO interactions
10. Call ends
11. Final webhook updates database


ğŸ’¬ SMS FLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. User sends SMS: "What are your hours?"
2. Telnyx receives SMS
3. Telnyx â†’ POST /api/webhooks/telnyx/sms
4. Find patient: SELECT * FROM patients WHERE phone = '...'
5. Log incoming: INSERT INTO interactions (direction='inbound')
6. AI processes message
7. Generate response: "We're open Mon-Fri 9AM-5PM"
8. Send SMS via Telnyx API
9. Log outgoing: INSERT INTO interactions (direction='outbound')
10. User receives SMS


ğŸ“Š ADMIN DASHBOARD FLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Admin opens /admin
2. app/admin/page.tsx loads
3. useEffect() â†’ loadDashboardData()
4. Parallel queries:
   - Count interactions
   - Count appointments
   - Count patients
   - Count today's activity
5. Get recent interactions (last 10)
6. Update state â†’ setStats(), setRecentInteractions()
7. React re-renders
8. Shows:
   - 4 stat cards
   - Recent interactions table


ğŸ—„ï¸ DATABASE TABLES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. clinics           - Clinic information
2. patients          - Patient records
3. appointments      - Appointment bookings
4. interactions      - All communications log
5. faqs              - Questions & answers
6. canned_responses  - Pre-written responses
7. call_logs         - Voice call details
8. audit_logs        - System audit trail


ğŸ”Œ API ENDPOINTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PUBLIC APIs:
GET  /api/clinics              - Get clinic info
GET  /api/faqs?q=hours         - Search FAQs
POST /api/appointments/find    - Find appointment
POST /api/appointments/confirm - Confirm appointment

WEBHOOK APIs:
POST /api/webhooks/vapi              - Voice call events
POST /api/webhooks/telnyx/sms        - SMS messages
POST /api/webhooks/telnyx/voice      - Voice call events


ğŸ“Š DATA FLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

User â†’ Frontend â†’ API Route â†’ Business Logic â†’ Database â†’ Response


DETAILED:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    USER     â”‚ (Website/SMS/Voice/Admin)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NEXT.JS    â”‚ (API Routes)
â”‚   APIs      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUSINESS   â”‚ (Patient Mgmt, AI Processing)
â”‚   LOGIC     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPABASE   â”‚ (PostgreSQL Database)
â”‚  DATABASE   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXTERNAL   â”‚ (Vapi, Telnyx, OpenAI)
â”‚  SERVICES   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ¯ COMPLETE EXAMPLE: SMS APPOINTMENT BOOKING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Step 1: User sends "I need an appointment"
Step 2: Telnyx â†’ POST /api/webhooks/telnyx/sms
Step 3: Check patient exists
Step 4: Create patient if new
Step 5: Log incoming message
Step 6: AI processes: "User wants appointment"
Step 7: Generate: "Sure! What date works?"
Step 8: Send SMS via Telnyx
Step 9: Log outgoing message
Step 10: User receives response
Step 11: User replies: "Tomorrow 2pm"
Step 12: Create appointment in database
Step 13: Send confirmation: "Booked! Code: ABC123"
Step 14: Admin sees new patient & appointment


ğŸ”‘ KEY FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

app/page.tsx                        - Homepage
app/admin/page.tsx                  - Admin dashboard
components/VapiVoiceCall.tsx        - Voice call button
lib/supabase.ts                     - Database client
app/api/webhooks/vapi/route.ts      - Voice webhooks
app/api/webhooks/telnyx/sms/route.ts - SMS webhooks
supabase/schema.sql                 - Database schema


ğŸ”’ SECURITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Row Level Security (RLS) enabled
âœ“ Environment variables in .env.local
âœ“ .env.local in .gitignore
âœ“ Phone number validation
âœ“ Input sanitization
âœ“ Service role for backend operations


âš¡ PERFORMANCE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Database indexes on phone, dates, timestamps
âœ“ Parallel queries with Promise.all()
âœ“ Efficient data fetching
âœ“ Optimized React rendering


ğŸ“ COMMON OPERATIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Add Patient:
await supabase.from('patients').insert({
  first_name, last_name, phone, email
});

Log Interaction:
await supabase.from('interactions').insert({
  channel: 'sms', direction: 'inbound', message_body
});

Create Appointment:
await supabase.from('appointments').insert({
  patient_id, appointment_date, status: 'scheduled'
});


ğŸ“ SUMMARY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Simple Flow:
User â†’ API â†’ Logic â†’ Database â†’ Response

Features:
âœ“ Multi-channel (Web, SMS, Voice)
âœ“ Real-time webhooks
âœ“ Complete logging
âœ“ Admin dashboard
âœ“ AI-powered responses
âœ“ Secure & scalable


ğŸ“š DOCUMENTATION FILES CREATED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. PROJECT-FLOW-ANALYSIS.md    - Detailed English analysis
2. CODE-FLOW-URDU.md            - Urdu/Hindi guide
3. QUICK-CODE-REFERENCE.txt     - This file (quick ref)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Project is fully analyzed and documented! ğŸ‰                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
